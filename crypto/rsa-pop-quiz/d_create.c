#include<stdio.h>
#include<gmp.h>
void rsa_crypto(mpz_t ans,mpz_t a,mpz_t e,mpz_t n){
    mpz_powm(ans,a,e,n);
}
void rsa_decrypto(mpz_t ans,mpz_t a,mpz_t d,mpz_t n){
    mpz_powm(ans,a,d,n);
}
int main(){
    //n set
    //char n_char[10000]="12738162802910546503821920886905393316386362759567480839428456525224226445173031635306683726182522494910808518920409019414034814409330094245825749680913204566832337704700165993198897029795786969124232138869784626202501366135975223827287812326250577148625360887698930625504334325804587329905617936581116392784684334664204309771430814449606147221349888320403451637882447709796221706470239625292297988766493746209684880843111138170600039888112404411310974758532603998608057008811836384597579147244737606088756299939654265086899096359070667266167754944587948695842171915048619846282873769413489072243477764350071787327913";
    char p_char[10000]="97846775312392801037224396977012615848433199640105786119757047098757998273009741128821931277074555731813289423891389911801250326299324018557072727051765547115514791337578758859803890173153277252326496062476389498019821358465433398338364421624871010292162533041884897182597065662521825095949253625730631876637";
    char q_char[10000]="92092076805892533739724722602668675840671093008520241548191914215399824020372076186460768206814914423802230398410980218741906960527104568970225804374404612617736579286959865287226538692911376507934256844456333236362669879347073756238894784951597211105734179388300051579994253565459304743059533646753003894559";

    mpz_t p,q;
    mpz_init(p);
    mpz_init(q);
    mpz_set_str(p,p_char,10);
    mpz_set_str(q,q_char,10);

    mpz_t _p,_q,totion;
    mpz_init(_p);
    mpz_init(_q);
    mpz_init(totion);

    mpz_sub_ui(_p,p,1);
    mpz_sub_ui(_q,q,1);
    mpz_mul(totion,_p,_q);


    // mpz_t n;
    // mpz_init(n);
    // mpz_set_str(n,n_char,10);
    // gmp_printf("n=%Zd\n",n);

    //e set
    mpz_t e;
    mpz_init(e);
    mpz_set_ui(e,65537);

    mpz_t d;
    mpz_init(d);
    mpz_invert(d,e,totion);
    gmp_printf("d=%Zd\n",d);

    //message
    // mpz_t m;
    // mpz_init(m);
    // char m_char[10000]="6357294171489311547190987615544575133581967886499484091352661406414044440475205342882841236357665973431462491355089413710392273380203038793241564304774271529108729717";

    // mpz_set_str(m,m_char,10);

    // //crypto
    // rsa_crypto(m,m,e,n);
    // gmp_printf("m=%Zd\n",m);

    //decrypto
    // mpz_t d;
    // mpz_init(d);
    // mpz_invert(d,e,n);
    // gmp_printf("d=%Zd\n",d);
    // rsa_decrypto(m,m,d,n);
    // gmp_printf("m=%Zd\n",m);

    // //decrypto test
    // mpz_t d_true;
    // mpz_t nn;

    // mpz_init(d_true);
    // mpz_init(nn);
    // mpz_set_ui(nn,160);

    // mpz_invert(d_true,e,nn);
    // gmp_printf("d_true=%Zd\n",d_true);
    // rsa_decrypto(m,m,d_true,n);
    // gmp_printf("m=%Zd\n",m);

    return 0;
}